---
title: "Installing Pop!\_OS on an unsupported 32-bit UEFI hardware"
date: 2020-04-18
permalink: /posts/2020/04/blog-post-15/install-modern-os-on-unsupported-hardware
redirect_from: /posts/2020/06/blog-post-15/
tags:
  - linux
  - boot
  - partitions
  - UEFI
---

I've been using Linux Mint for quite a while (like past 4 years) and wanted some change.
Pop!\_OS seemed another good Ubuntu-based distro so I decided to try it out. However,
there is a problem. Since the hardware I use is 32-bit only UEFI without legacy BIOS.
Pop!\_OS on the otherhand ships ISOs for use only with 64-bit UEFIs and legacy BIOS (but
disregards support for 32-bit UEFI and that's bad since my hardware is 32-bit UEFI only).

I don't really blame developers for not supporting 32-bit UEFI. This is not just the
case with Pop!\_OS but with pretty much almost all major distributions out there. I read
somewhere that Fedora did support such machines back in 2018, although I'm not sure of what
the current status is. 32-bit UEFI machines are pretty rare in 2020 and I understand that
supporting such a minority of users is not worth the developer time spent.

With what I write here, I expect to document how to get stuff working on such machines in
the hope that this would atleast be useful to people a bit familiar with how Linux works.
Move on by assuming that there will sometimes be hardware peripherals that will fail to be
recognized properly (such as WiFi, sound output) and random irrecoverable freezes.
I suffer from both these without a solution as of yet. I also happen to be hit by some
other unexplained stuff as I'll mention later. Anyway, since I'm writing all of this from
memory, expect some very specific details to lack in precision.

Two years back when I installed Linux Mint 19 on this same hardware, the situation wasn't
as bad as it is now. You'd use `dd` or `cat` from coreutils or specialized tools such as
Rufus or UNetbootin to write the iso image on to a USB device. When trying to boot this USB
device on a 32-bit UEFI machine you'd notice that it won't even show up as a boot device.
At this point, the first response would be to put a `bootia32.efi` in `/efi/boot/` on your
USB. However, if you wrote the iso image on the USB in dd-mode (as termed in Rufus) you now
won't be able to add or remove files from your USB stick since the USB stick would be stuck
in read-only mode. I haven't come across a way to make writable except completely formatting
it in such a case. Either way, UEFI specification states that it can read boot files from
`/efi/boot` even if there is no specialized EFI partition available. So IMO the best way to
write an iso image to a USB device would be to first locally mount the iso image and then simply
copy-paste the mounted files on to a USB stick which has been first formatted as `FAT32`. I
say `FAT32` because I've had an easier time with it, otherwise I sometimes had problems with
my hardware's UEFI not determining `ext4` partitions as bootable. The USB stick will still be
writable at this point and you can now copy `bootia32.efi` to `/efi/boot/` as previously
mentioned. With this I was successfully be able to boot into live Linux Mint from my USB stick.
At this point, one should notice all the hardware stuff that fails to be recognized. Some things
to think of: whether battery percentage reduces when not plugged-in? If charger plugged-in
display indicator shows correctly? WiFi works? Brightness controls? Sound output from speakers
and 3.5mm jack? Is trackpad being detected as an external mouse (that means no two-finger
scrolling and "disable mouse when typing" does not work)? If you're hitting some of these
issues, I've mostly had more luck with learning to live with them than looking for solutions
on the Internet. It might be possible to write a custom driver or a kernel module to fix an
issue but that's beyond me. In any case, you'd normally select the partition where you want
to install Linux Mint and make sure that you create and EFI partition with ~200MB if it doesn't
already exist, and next, next. Everything would go fine until at the end of the
installation it mentions that it failed to install a boot loader. You could now reboot and
see that our newly installed Linux Mint isn't available in the boot menu! I know of two ways
to fix this from here:

1. You'd reboot your machine when the failure message pops up. Now you'd again select your
bootable USB drive, but this time go to advanced options and it should mention something
about accessing the GRUB command-line by pressing `c` key on the keyboard. Do that and it
will drop us to a shell. Here we'll attempt to manually load the kernel image and the initial
RAM disk. The first step is to recognize the drive and partition where you installed Linux
Mint to. This can be done by using `ls`:
```shell
$ ls (hd0)/
# Is this what I need? Nope.
$ ls (hd0,gpt1)/
# Is this what I need? Yup!
```
Once you've recognized your drive and partition, note its UUID by running `ls -l`:
```
$ ls -l (hd0,gpt1)/
# <stuff> UUID 46868037-2224-4887-adfe-d1db9fe93366 <stuff>
```
The UUID is the the alphanumeric characters such as in the above case, the UUID is:
`46868037-2224-4887-adfe-d1db9fe93366`. Sometimes `ls` might not accept the `-l` parameter.
In such a case, omit `root=UUID=6868037-2224-4887-adfe-d1db9fe93366` from the below command.
Now, we load the kernel image with:
```
$ linux (hd0,gpt1)/boot/vmlinuz.efi root=UUID=6868037-2224-4887-adfe-d1db9fe93366
```
replace the above alphanumerics with your obtained UUID.

Now load the initial RAM disk:
```
$ initrd /(hd0,gpt1)/boot/initrd.gz
```

The filenames may not exactly be `vmlinuz.efi` or `initrd.gz` but should closely resemble
them. So, try loading whatever seems the closest filename to you.

Now do
```
$ boot
```
If your `ls` didn't support `-l` option and you omitted the UUID, the kernel will fail
to load and will drop you into a busybox shell which can now be used to read the all the
connected devices UUIDs by running:
```
$ ls -l /dev/disk/by-uuid/
```
If still not sure here what device and partition you installed Linux Mint, try `mkdir`
and mount the device files from `/dev/sdXY` on to this directory and then `ls`. Either
way you should now have the correct UUID. Click a picture of it or note it down and
repeat the above mentioned steps but now by entering the UUID when loading the kernel
image.

It would now successfully boot into the installed Linux Mint and now we fix the boot menu
so it shows up in the boot menu.
```
$ sudo apt install grub-efi-ia32-bin
```
Check which partition on your hard drive is your EFI partition. I'd assume `/dev/sda2`
here:
```
$ mkdir /boot/EFI
$ sudo mount /dev/sda2 /boot/EFI
$ sudo grub-install /dev/sda2 --efi-directory=/boot/EFI
```
Update the menus:
```
$ sudo update-grub
```
If `grub-update` fails, run this instead:
```
$ grub-mkconfig -o /boot/grub/grub.cfg
```

Everything should be fixed now. Reboot and check your boot menu.
https://medium.com/@realzedgoat/a-sorta-beginners-guide-to-installing-ubuntu-linux-on-32-bit-uefi-machines-d39b1d1961ec

2. That was the first way, now the second way of fixing this boot menu is via chroot.
When Linux Mint errors on saying that the bootloader failed to install. Do not reboot.
Instead open a terminal and check where the new Linux Mint got installed. I'd assume
in `/dev/sda3`. Do this:
```
$ sudo mount /dev/sda3 /mnt
$ sudo mount --bind /dev/ /mnt/dev
$ sudo mount --bind /sys /mnt/sys
$ sudo mount --bind /proc /mnt/proc
$ sudo chroot /mnt
```
Now you run the commands mentioned in the 1st method starting from the `apt install grub-efi-ia32-bin` part.
Ok, fixed. Reboot and see.

TO BE CONTINUED...
